$(document).ready(function(){if(typeof(formatedAddressFieldsValuesList)!=='undefined')updateAddressesDisplay(true);resizeAddressesBox()});function updateAddressesDisplay(first_view){updateAddressDisplay('delivery');var txtInvoiceTitle="";try{var adrs_titles=getAddressesTitles();txtInvoiceTitle=adrs_titles.invoice}catch(e){}if($('input[type=checkbox]#addressesAreEquals:checked').length===1&&($('#multishipping_mode_checkbox:checked').length===0)){if($('#multishipping_mode_checkbox:checked').length===0){$('#address_invoice_form:visible').hide('fast')}$('ul#address_invoice').html($('ul#address_delivery').html());$('ul#address_invoice li.address_title').html(txtInvoiceTitle)}else{$('#address_invoice_form:hidden').show('fast');if($('#id_address_invoice').val())updateAddressDisplay('invoice');else{$('ul#address_invoice').html($('ul#address_delivery').html());$('ul#address_invoice li.address_title').html(txtInvoiceTitle)}}if(!first_view){if(orderProcess==='order')updateAddresses()}return true}function updateAddressDisplay(addressType){if(formatedAddressFieldsValuesList.length<=0)return false;var idAddress=parseInt($('#id_address_'+addressType+'').val());buildAddressBlock(idAddress,addressType,$('#address_'+addressType));var link=$('ul#address_'+addressType+' li.address_update a').attr('href');var expression=/id_address=\d+/;if(link){link=link.replace(expression,'id_address='+idAddress);$('ul#address_'+addressType+' li.address_update a').attr('href',link)}resizeAddressesBox()}function updateAddresses(){var idAddress_delivery=parseInt($('#id_address_delivery').val());var idAddress_invoice=$('input[type=checkbox]#addressesAreEquals:checked').length===1?idAddress_delivery:parseInt($('#id_address_invoice').val());if(isNaN(idAddress_delivery)==false&&isNaN(idAddress_invoice)==false)$.ajax({type:'POST',headers:{"cache-control":"no-cache"},url:baseUri+'?rand='+new Date().getTime(),async:true,cache:false,dataType:"json",data:{processAddress:true,step:2,ajax:'true',controller:'order','multi-shipping':$('#id_address_delivery:hidden').length,id_address_delivery:idAddress_delivery,id_address_invoice:idAddress_invoice,token:static_token},success:function(jsonData){if(jsonData.hasError){var errors='';for(var error in jsonData.errors)if(error!=='indexOf')errors+=$('<div />').html(jsonData.errors[error]).text()+"\n";alert(errors)}},error:function(XMLHttpRequest,textStatus,errorThrown){if(textStatus!=='abort')alert("TECHNICAL ERROR: unable to save adresses \n\nDetails:\nError thrown: "+XMLHttpRequest+"\n"+'Text status: '+textStatus)}});resizeAddressesBox()}